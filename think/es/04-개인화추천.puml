@startuml
!theme mono

title 04. 개인화 추천 플로우

actor "직장인사용자" as User
participant "가이드북시스템" as System
participant "추천엔진" as RecommendEngine
participant "사용자프로필DB" as ProfileDB
participant "AI도구정보DB" as ToolDB
participant "사용자행동로그시스템" as LogSystem
participant "외부데이터소스" as ExternalData

== 이벤트: 개인화 프로필 구성 ==

User -> System: **커맨드: 개인화설정시작**\n(사용자ID, 기본선호정보)

activate System
System -> ProfileDB: **커맨드: 사용자프로필조회**\n(사용자ID)
activate ProfileDB

note right of System
  **정책/규칙:**
  - 최소 3회 이상 사용 이력이 있어야 개인화 추천 활성화
  - 업무 도메인별 사용 패턴 가중치 적용
  - 개인정보보호 규정 준수 (익명화된 패턴만 활용)
  - 추천 이유 투명성 확보 (설명 가능한 AI)
end note

ProfileDB --> System: **이벤트: 사용자프로필조회됨**\n(기본정보, 선호설정, 사용이력)
deactivate ProfileDB

System -> LogSystem: **커맨드: 행동패턴분석요청**\n(사용자ID, 분석기간)
activate LogSystem
LogSystem --> System: **이벤트: 행동패턴분석됨**\n(사용패턴, 선호카테고리, 활용빈도)
deactivate LogSystem

System -> RecommendEngine: **커맨드: 개인화모델훈련**\n(사용자프로필, 행동패턴, 선호정보)
activate RecommendEngine
RecommendEngine --> System: **이벤트: 개인화프로필구성됨**\n(추천모델, 가중치설정, 선호도점수)
deactivate RecommendEngine

System --> User: **이벤트: 개인화설정완료됨**\n(프로필요약, 추천기준설명)

== 이벤트: 실시간 맞춤 추천 생성 ==

System -> RecommendEngine: **커맨드: 실시간추천요청**\n(사용자ID, 현재컨텍스트, 시간대)
activate RecommendEngine

RecommendEngine -> ToolDB: **커맨드: 추천후보도구조회**\n(사용자프로필매칭, 최신도구정보)
activate ToolDB
ToolDB --> RecommendEngine: **이벤트: 추천후보도구조회됨**\n(매칭도구목록, 관련도점수)
deactivate ToolDB

RecommendEngine -> ExternalData: **커맨드: 트렌드데이터조회**\n(업계트렌드, 도구인기도)
activate ExternalData
ExternalData --> RecommendEngine: **이벤트: 트렌드데이터수집됨**\n(인기도순위, 트렌드지수)
deactivate ExternalData

RecommendEngine --> System: **이벤트: 맞춤추천생성됨**\n(추천도구목록, 추천이유, 신뢰도점수)
deactivate RecommendEngine

System --> User: **이벤트: 개인화추천표시됨**\n(추천도구카드, 추천이유, 유사사용자피드백)

== 이벤트: 추천 피드백 수집 ==

User -> System: **커맨드: 추천피드백제공**\n(추천ID, 피드백: 유용함/보통/유용하지않음, 상세의견)
activate System

System -> LogSystem: **커맨드: 피드백데이터저장**\n(사용자ID, 추천ID, 피드백내용)
activate LogSystem
LogSystem --> System: **이벤트: 추천피드백기록됨**\n(피드백ID, 학습데이터라벨링)
deactivate LogSystem

System -> RecommendEngine: **커맨드: 추천모델업데이트**\n(피드백데이터, 학습파라미터조정)
activate RecommendEngine
RecommendEngine --> System: **이벤트: 추천모델개선됨**\n(모델정확도, 개선사항)
deactivate RecommendEngine

System --> User: **이벤트: 피드백반영완료됨**\n(감사메시지, 개선된추천품질안내)

== 이벤트: 추천 성과 분석 ==

System -> RecommendEngine: **커맨드: 추천성과분석**\n(분석기간, 성과지표)
activate RecommendEngine

RecommendEngine -> LogSystem: **커맨드: 추천성과데이터조회**\n(클릭률, 전환율, 만족도)
activate LogSystem
LogSystem --> RecommendEngine: **이벤트: 성과데이터수집됨**\n(성과메트릭, 사용자만족도통계)
deactivate LogSystem

RecommendEngine --> System: **이벤트: 추천성과분석완료됨**\n(성과리포트, 개선제안사항)
deactivate RecommendEngine

System -> ProfileDB: **커맨드: 사용자프로필업데이트**\n(개선된추천설정, 업데이트된선호도)
activate ProfileDB
ProfileDB --> System: **이벤트: 프로필업데이트됨**\n(업데이트확인, 다음추천개선예상)
deactivate ProfileDB

deactivate System

note over User, ExternalData
  **필요한 데이터:**
  - 커맨드 데이터: 사용자ID, 선호정보, 피드백내용, 컨텍스트정보
  - 이벤트 데이터: 추천모델, 추천결과, 성과메트릭, 프로필정보
  
  **External System:**
  - 추천엔진: 머신러닝 기반 개인화 추천 알고리즘  
  - 외부데이터소스: 업계 트렌드, 도구 인기도 데이터
  - 사용자프로필DB: 개인화 설정 및 선호도 저장소
end note

@enduml