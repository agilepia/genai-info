<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§Œì¡±ë„ í‰ê°€ - AI ë„êµ¬ ì°¾ê¸°</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .evaluation-layout {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .evaluation-content {
            flex: 1;
            padding: var(--space-xl) 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .evaluation-container {
            width: 100%;
            max-width: 600px;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--space-xxxl);
            margin: var(--space-lg);
        }
        
        .evaluation-header {
            text-align: center;
            margin-bottom: var(--space-xxxl);
        }
        
        .evaluation-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-lg);
            font-size: var(--font-size-h1);
            color: white;
        }
        
        .evaluation-title {
            color: var(--color-gray-900);
            margin-bottom: var(--space-sm);
        }
        
        .evaluation-subtitle {
            color: var(--color-gray-500);
            font-size: var(--font-size-body);
        }
        
        .tool-summary {
            background: var(--color-gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            margin-bottom: var(--space-xxxl);
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .tool-logo-small {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-lg);
            background: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: var(--font-size-h4);
        }
        
        .tool-info-summary {
            flex: 1;
        }
        
        .tool-name-summary {
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: var(--space-xs);
        }
        
        .tool-company-summary {
            color: var(--color-gray-500);
            font-size: var(--font-size-body);
        }
        
        .rating-section {
            margin-bottom: var(--space-xxxl);
        }
        
        .section-title {
            font-size: var(--font-size-h3);
            font-weight: 600;
            color: var(--color-gray-900);
            margin-bottom: var(--space-lg);
            text-align: center;
        }
        
        .star-rating {
            display: flex;
            justify-content: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .star {
            font-size: 48px;
            color: var(--color-gray-200);
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .star:hover,
        .star.active {
            color: var(--color-warning);
            transform: scale(1.1);
        }
        
        .rating-text {
            text-align: center;
            font-size: var(--font-size-h4);
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: var(--space-lg);
            min-height: 30px;
        }
        
        .feedback-section {
            margin-bottom: var(--space-xxxl);
        }
        
        .feedback-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .feedback-option {
            padding: var(--space-md);
            border: 2px solid var(--color-gray-100);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            background: white;
        }
        
        .feedback-option:hover {
            border-color: var(--color-primary);
            background: var(--color-primary-light);
        }
        
        .feedback-option.selected {
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: white;
        }
        
        .feedback-icon {
            font-size: var(--font-size-h2);
            margin-bottom: var(--space-sm);
        }
        
        .feedback-title {
            font-weight: 500;
            margin-bottom: var(--space-xs);
        }
        
        .feedback-description {
            font-size: var(--font-size-caption);
            opacity: 0.8;
        }
        
        .improvement-section {
            display: none;
            margin-bottom: var(--space-xl);
        }
        
        .improvement-section.show {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        
        .improvement-title {
            font-size: var(--font-size-h4);
            font-weight: 600;
            color: var(--color-error);
            margin-bottom: var(--space-lg);
            text-align: center;
        }
        
        .improvement-options {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        .improvement-option {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .improvement-option:hover {
            background: var(--color-gray-50);
        }
        
        .comments-section {
            margin-bottom: var(--space-xl);
        }
        
        .comments-title {
            font-weight: 500;
            color: var(--color-gray-900);
            margin-bottom: var(--space-md);
        }
        
        .form-actions {
            display: flex;
            gap: var(--space-md);
            justify-content: center;
            margin-top: var(--space-xxxl);
        }
        
        .success-message {
            display: none;
            text-align: center;
            padding: var(--space-xxxl);
        }
        
        .success-icon {
            font-size: 64px;
            margin-bottom: var(--space-lg);
        }
        
        .success-title {
            font-size: var(--font-size-h2);
            font-weight: 600;
            color: var(--color-success);
            margin-bottom: var(--space-md);
        }
        
        .success-text {
            color: var(--color-gray-700);
            margin-bottom: var(--space-xl);
        }
        
        @media (max-width: 768px) {
            .evaluation-container {
                margin: var(--space-md);
                padding: var(--space-xl);
            }
            
            .star {
                font-size: 40px;
            }
            
            .feedback-options {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="evaluation-layout">
        <!-- í—¤ë” -->
        <header class="header">
            <div class="container">
                <div class="header__content">
                    <a href="03-ë©”ì¸ëŒ€ì‹œë³´ë“œ.html" class="header__logo">AI ë„êµ¬ ì°¾ê¸°</a>
                    <div class="header__nav">
                        <div class="header__user">
                            <div class="header__avatar" id="userAvatar">ê¹€</div>
                            <span id="userName">ê¹€ì² ìˆ˜</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="evaluation-content">
            <div class="evaluation-container fade-in" id="evaluationForm">
                <div class="evaluation-header">
                    <div class="evaluation-icon">ğŸ“</div>
                    <h1 class="evaluation-title">ë§Œì¡±ë„ í‰ê°€</h1>
                    <p class="evaluation-subtitle">ì¶”ì²œ ê²°ê³¼ì— ë§Œì¡±í•˜ì…¨ë‚˜ìš”? ì—¬ëŸ¬ë¶„ì˜ ì˜ê²¬ì„ ë“¤ë ¤ì£¼ì„¸ìš”.</p>
                </div>
                
                <!-- ë„êµ¬ ìš”ì•½ -->
                <div class="tool-summary">
                    <div class="tool-logo-small" id="toolLogoSmall">AI</div>
                    <div class="tool-info-summary">
                        <div class="tool-name-summary" id="toolNameSummary">ë„êµ¬ ì´ë¦„</div>
                        <div class="tool-company-summary" id="toolCompanySummary">ê°œë°œì‚¬</div>
                    </div>
                </div>
                
                <form id="feedbackForm">
                    <!-- ë³„ì  í‰ê°€ -->
                    <div class="rating-section">
                        <h2 class="section-title">ì¶”ì²œ ê²°ê³¼ì— ì–¼ë§ˆë‚˜ ë§Œì¡±í•˜ì…¨ë‚˜ìš”?</h2>
                        
                        <div class="star-rating" id="starRating">
                            <span class="star" data-rating="1">â­</span>
                            <span class="star" data-rating="2">â­</span>
                            <span class="star" data-rating="3">â­</span>
                            <span class="star" data-rating="4">â­</span>
                            <span class="star" data-rating="5">â­</span>
                        </div>
                        
                        <div class="rating-text" id="ratingText"></div>
                        <input type="hidden" id="ratingValue" name="rating" required>
                    </div>
                    
                    <!-- í”¼ë“œë°± ì˜µì…˜ -->
                    <div class="feedback-section" id="positiveSection">
                        <h3 class="section-title" style="font-size: var(--font-size-h4);">ì–´ë–¤ ì ì´ ì¢‹ì•˜ë‚˜ìš”? (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</h3>
                        
                        <div class="feedback-options">
                            <div class="feedback-option" data-feedback="accuracy">
                                <div class="feedback-icon">ğŸ¯</div>
                                <div class="feedback-title">ì •í™•í•œ ì¶”ì²œ</div>
                                <div class="feedback-description">í•„ìš”ì— ë”± ë§ëŠ” ë„êµ¬</div>
                            </div>
                            
                            <div class="feedback-option" data-feedback="variety">
                                <div class="feedback-icon">ğŸ”„</div>
                                <div class="feedback-title">ë‹¤ì–‘í•œ ì˜µì…˜</div>
                                <div class="feedback-description">ì„ íƒì˜ í­ì´ ë„“ìŒ</div>
                            </div>
                            
                            <div class="feedback-option" data-feedback="explanation">
                                <div class="feedback-icon">ğŸ’¡</div>
                                <div class="feedback-title">ëª…í™•í•œ ì„¤ëª…</div>
                                <div class="feedback-description">ì¶”ì²œ ì´ìœ ê°€ ì´í•´ë¨</div>
                            </div>
                            
                            <div class="feedback-option" data-feedback="easyuse">
                                <div class="feedback-icon">ğŸ‘</div>
                                <div class="feedback-title">ì‚¬ìš© í¸ì˜ì„±</div>
                                <div class="feedback-description">ì‰½ê³  ë¹ ë¥¸ ì´ìš©</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ê°œì„  í•„ìš” ì˜ì—­ (3ì  ì´í•˜ ì‹œ í‘œì‹œ) -->
                    <div class="improvement-section" id="improvementSection">
                        <h3 class="improvement-title">ì–´ë–¤ ë¶€ë¶„ì´ ê°œì„ ë˜ë©´ ì¢‹ì„ê¹Œìš”?</h3>
                        
                        <div class="improvement-options">
                            <label class="improvement-option">
                                <input type="checkbox" name="improvements" value="more_options">
                                <span>ë” ë§ì€ ë„êµ¬ ì˜µì…˜</span>
                            </label>
                            
                            <label class="improvement-option">
                                <input type="checkbox" name="improvements" value="better_matching">
                                <span>ë” ì •í™•í•œ ë§¤ì¹­</span>
                            </label>
                            
                            <label class="improvement-option">
                                <input type="checkbox" name="improvements" value="detailed_info">
                                <span>ë” ìƒì„¸í•œ ë„êµ¬ ì •ë³´</span>
                            </label>
                            
                            <label class="improvement-option">
                                <input type="checkbox" name="improvements" value="faster_response">
                                <span>ë” ë¹ ë¥¸ ì‘ë‹µ ì†ë„</span>
                            </label>
                            
                            <label class="improvement-option">
                                <input type="checkbox" name="improvements" value="ui_improvement">
                                <span>ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ê°œì„ </span>
                            </label>
                            
                            <label class="improvement-option">
                                <input type="checkbox" name="improvements" value="other">
                                <span>ê¸°íƒ€</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- ììœ  ì˜ê²¬ -->
                    <div class="comments-section">
                        <label class="comments-title" for="comments">ì¶”ê°€ ì˜ê²¬ì´ë‚˜ ì œì•ˆì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë‚¨ê²¨ì£¼ì„¸ìš” (ì„ íƒì‚¬í•­)</label>
                        <textarea 
                            class="form-textarea" 
                            id="comments" 
                            name="comments" 
                            placeholder="ì„œë¹„ìŠ¤ ê°œì„ ì„ ìœ„í•œ ì†Œì¤‘í•œ ì˜ê²¬ì„ ë“¤ë ¤ì£¼ì„¸ìš”..."
                            rows="4"
                        ></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="skipBtn">ê±´ë„ˆë›°ê¸°</button>
                        <button type="submit" class="btn btn-primary btn-large" id="submitBtn">í‰ê°€ ì™„ë£Œ</button>
                    </div>
                </form>
            </div>
            
            <!-- ì™„ë£Œ ë©”ì‹œì§€ -->
            <div class="evaluation-container success-message" id="successMessage">
                <div class="success-icon">ğŸ‰</div>
                <h2 class="success-title">í‰ê°€ ì™„ë£Œ!</h2>
                <p class="success-text">
                    ì†Œì¤‘í•œ ì˜ê²¬ì„ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.<br>
                    ë” ë‚˜ì€ AI ë„êµ¬ ì¶”ì²œ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ ë‚˜ê°€ê² ìŠµë‹ˆë‹¤.
                </p>
                
                <div class="form-actions">
                    <button class="btn btn-secondary" id="backToResultsBtn">ì¶”ì²œ ê²°ê³¼ë¡œ</button>
                    <button class="btn btn-primary" id="backToMainBtn">ë©”ì¸ìœ¼ë¡œ</button>
                </div>
            </div>
        </main>
    </div>
    
    <script src="common.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ë¡œê·¸ì¸ ì²´í¬
            if (!AppState.user) {
                Utils.navigateTo('01-ë¡œê·¸ì¸');
                return;
            }
            
            // ì„ íƒëœ ë„êµ¬ê°€ ì—†ìœ¼ë©´ ì´ì „ í™”ë©´ìœ¼ë¡œ
            if (!AppState.selectedTool) {
                Utils.navigateTo('05-ì¶”ì²œê²°ê³¼');
                return;
            }
            
            // UI ì´ˆê¸°í™”
            initializeUI();
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();
            
            function initializeUI() {
                // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                const userAvatar = Utils.$('#userAvatar');
                const userName = Utils.$('#userName');
                
                if (AppState.user) {
                    userAvatar.textContent = AppState.user.avatar || AppState.user.name.charAt(0);
                    userName.textContent = AppState.user.name;
                }
                
                // ë„êµ¬ ì •ë³´ í‘œì‹œ
                const tool = AppState.selectedTool;
                Utils.$('#toolLogoSmall').textContent = tool.logo;
                Utils.$('#toolNameSummary').textContent = tool.name;
                Utils.$('#toolCompanySummary').textContent = tool.company;
            }
            
            function setupEventListeners() {
                // ë³„ì  í´ë¦­
                const stars = Utils.$$('.star');
                stars.forEach(star => {
                    Utils.on(star, 'click', function() {
                        const rating = parseInt(this.dataset.rating);
                        setRating(rating);
                    });
                    
                    Utils.on(star, 'mouseover', function() {
                        const rating = parseInt(this.dataset.rating);
                        highlightStars(rating);
                    });
                });
                
                // ë³„ì  ì˜ì—­ì—ì„œ ë§ˆìš°ìŠ¤ê°€ ë‚˜ê°ˆ ë•Œ
                Utils.on(Utils.$('#starRating'), 'mouseleave', function() {
                    const currentRating = parseInt(Utils.$('#ratingValue').value) || 0;
                    highlightStars(currentRating);
                });
                
                // í”¼ë“œë°± ì˜µì…˜ í´ë¦­
                const feedbackOptions = Utils.$$('.feedback-option');
                feedbackOptions.forEach(option => {
                    Utils.on(option, 'click', function() {
                        this.classList.toggle('selected');
                    });
                });
                
                // í¼ ì œì¶œ
                Utils.on(Utils.$('#feedbackForm'), 'submit', async function(e) {
                    e.preventDefault();
                    await submitFeedback();
                });
                
                // ê±´ë„ˆë›°ê¸° ë²„íŠ¼
                Utils.on(Utils.$('#skipBtn'), 'click', function() {
                    Utils.navigateTo('03-ë©”ì¸ëŒ€ì‹œë³´ë“œ');
                });
                
                // ì™„ë£Œ í›„ ë²„íŠ¼ë“¤
                Utils.on(Utils.$('#backToResultsBtn'), 'click', function() {
                    Utils.navigateTo('05-ì¶”ì²œê²°ê³¼');
                });
                
                Utils.on(Utils.$('#backToMainBtn'), 'click', function() {
                    Utils.navigateTo('03-ë©”ì¸ëŒ€ì‹œë³´ë“œ');
                });
            }
            
            function setRating(rating) {
                Utils.$('#ratingValue').value = rating;
                highlightStars(rating);
                updateRatingText(rating);
                
                // 3ì  ì´í•˜ì¼ ë•Œ ê°œì„  ì„¹ì…˜ í‘œì‹œ
                const improvementSection = Utils.$('#improvementSection');
                const positiveSection = Utils.$('#positiveSection');
                
                if (rating <= 3) {
                    improvementSection.classList.add('show');
                    positiveSection.style.display = 'none';
                } else {
                    improvementSection.classList.remove('show');
                    positiveSection.style.display = 'block';
                }
            }
            
            function highlightStars(rating) {
                const stars = Utils.$$('.star');
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.classList.add('active');
                    } else {
                        star.classList.remove('active');
                    }
                });
            }
            
            function updateRatingText(rating) {
                const texts = {
                    1: 'ë§¤ìš° ë¶ˆë§Œì¡±',
                    2: 'ë¶ˆë§Œì¡±',
                    3: 'ë³´í†µ',
                    4: 'ë§Œì¡±',
                    5: 'ë§¤ìš° ë§Œì¡±'
                };
                
                const colors = {
                    1: 'var(--color-error)',
                    2: 'var(--color-error)',
                    3: 'var(--color-warning)',
                    4: 'var(--color-success)',
                    5: 'var(--color-success)'
                };
                
                const ratingText = Utils.$('#ratingText');
                ratingText.textContent = texts[rating] || '';
                ratingText.style.color = colors[rating] || 'var(--color-primary)';
            }
            
            async function submitFeedback() {
                const formData = collectFormData();
                
                // ë³„ì ì€ í•„ìˆ˜
                if (!formData.rating) {
                    Utils.showToast('ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                    return;
                }
                
                const submitBtn = Utils.$('#submitBtn');
                Utils.showLoading(submitBtn, 'í‰ê°€ ì €ì¥ ì¤‘...');
                
                try {
                    const result = await MockAPI.saveFeedback(formData);
                    
                    if (result.success) {
                        // ì„±ê³µ í™”ë©´ í‘œì‹œ
                        showSuccessMessage();
                    } else {
                        Utils.showToast('í‰ê°€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                        submitBtn.innerHTML = 'í‰ê°€ ì™„ë£Œ';
                        submitBtn.disabled = false;
                    }
                    
                } catch (error) {
                    console.error('Feedback submission error:', error);
                    Utils.showToast('í‰ê°€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    submitBtn.innerHTML = 'í‰ê°€ ì™„ë£Œ';
                    submitBtn.disabled = false;
                }
            }
            
            function collectFormData() {
                const rating = parseInt(Utils.$('#ratingValue').value);
                
                // ê¸ì •ì  í”¼ë“œë°± (4ì  ì´ìƒ)
                const selectedFeedbacks = Array.from(Utils.$$('.feedback-option.selected'))
                    .map(option => option.dataset.feedback);
                
                // ê°œì„  í•„ìš” ì‚¬í•­ (3ì  ì´í•˜)
                const selectedImprovements = Array.from(Utils.$$('input[name="improvements"]:checked'))
                    .map(checkbox => checkbox.value);
                
                const comments = Utils.$('#comments').value.trim();
                
                return {
                    toolId: AppState.selectedTool.id,
                    toolName: AppState.selectedTool.name,
                    rating: rating,
                    positiveFeedback: rating > 3 ? selectedFeedbacks : [],
                    improvements: rating <= 3 ? selectedImprovements : [],
                    comments: comments,
                    userId: AppState.user.id,
                    timestamp: new Date().toISOString()
                };
            }
            
            function showSuccessMessage() {
                const evaluationForm = Utils.$('#evaluationForm');
                const successMessage = Utils.$('#successMessage');
                
                evaluationForm.style.display = 'none';
                successMessage.style.display = 'block';
                successMessage.classList.add('fade-in');
            }
        });
    </script>
</body>
</html>
